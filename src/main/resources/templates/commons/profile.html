<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <title th:text="${profile != null ? 'H·ªì s∆° | ' + profile.fullName : 'H·ªì s∆° c√° nh√¢n'}">
        H·ªì s∆° c√° nh√¢n
    </title>

    <link href="/assets/css/styles.css" rel="stylesheet"/>
    <link href="/assets/css/user-home.css" rel="stylesheet"/>
    <link href="/assets/css/profile.css" rel="stylesheet"/>
</head>
<body class="pf-dark">

<div class="pf-container">
    <main class="pf-main container">

        <!-- ========== LEFT COLUMN ========== -->
        <section class="pf-left">
            <a href="/projects" class="pf-back-btn">
                ‚Üê Quay v·ªÅ
            </a>

            <div class="pf-card pf-profile">
                <!-- Avatar + name -->
                <div class="pf-avatar-wrap">
                    <img class="pf-avatar"
                         th:src="${profile != null && profile.avatarUrl != null
                                 ? profile.avatarUrl
                                 : '/images/team/1.jpg'}"
                         alt="avatar">
                    <div class="pf-name" th:text="${profile.fullName}">User name</div>
                    <div class="pf-subtitle">
                        <span th:text="${profile.globalRole}">User</span>
                        <span> ‚Ä¢ </span>
                        <span th:text="${profile.workMode}">Online</span>
                    </div>
                </div>

                <!-- Gi·ªõi thi·ªáu -->
                <div class="pf-section-title">Gi·ªõi thi·ªáu</div>
                <div class="pf-fields">

                    <!-- Ch·ª©c danh -->
                    <div class="pf-field">
                        <div class="pf-icon">üíº</div>
                        <div class="pf-body">
                            <label>Ch·ª©c danh</label>
                            <div class="pf-static"
                                 th:if="${profile.title != null and !#strings.isEmpty(profile.title)}"
                                 th:text="${profile.title}">
                                Developer
                            </div>
                            <div class="pf-static pf-muted"
                                 th:if="${profile.title == null or #strings.isEmpty(profile.title)}">
                                Ch∆∞a c·∫≠p nh·∫≠t
                            </div>
                        </div>
                    </div>

                    <!-- Ph√≤ng ban -->
                    <div class="pf-field">
                        <div class="pf-icon">üß©</div>
                        <div class="pf-body">
                            <label>Ph√≤ng ban</label>
                            <div class="pf-static"
                                 th:if="${profile.department != null and !#strings.isEmpty(profile.department)}"
                                 th:text="${profile.department}">
                                Product
                            </div>
                            <div class="pf-static pf-muted"
                                 th:if="${profile.department == null or #strings.isEmpty(profile.department)}">
                                Ch∆∞a c·∫≠p nh·∫≠t
                            </div>
                        </div>
                    </div>

                    <!-- T·ªï ch·ª©c -->
                    <div class="pf-field">
                        <div class="pf-icon">üè¢</div>
                        <div class="pf-body">
                            <label>T·ªï ch·ª©c</label>
                            <div class="pf-static"
                                 th:if="${profile.organization != null and !#strings.isEmpty(profile.organization)}"
                                 th:text="${profile.organization}">
                                Company
                            </div>
                            <div class="pf-static pf-muted"
                                 th:if="${profile.organization == null or #strings.isEmpty(profile.organization)}">
                                Ch∆∞a c·∫≠p nh·∫≠t
                            </div>
                        </div>
                    </div>

                    <!-- V·ªã tr√≠ -->
                    <div class="pf-field">
                        <div class="pf-icon">üìç</div>
                        <div class="pf-body">
                            <label>V·ªã tr√≠</label>
                            <div class="pf-static"
                                 th:if="${profile.location != null and !#strings.isEmpty(profile.location)}"
                                 th:text="${profile.location}">
                                H·ªì Ch√≠ Minh
                            </div>
                            <div class="pf-static pf-muted"
                                 th:if="${profile.location == null or #strings.isEmpty(profile.location)}">
                                Ch∆∞a c·∫≠p nh·∫≠t
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Li√™n h·ªá -->
                <div class="pf-section-title">Li√™n h·ªá</div>
                <div class="pf-contact">
                    <div class="pf-contact-row">
                        <div class="pf-icon">‚úâÔ∏è</div>
                        <div class="pf-contact-text" th:text="${profile.email}">email@example.com</div>
                    </div>
                    <div class="pf-contact-row" th:if="${profile.phoneNumber != null}">
                        <div class="pf-icon">üìû</div>
                        <div class="pf-contact-text" th:text="${profile.phoneNumber}">0123 456 789</div>
                    </div>
                </div>

                <!-- K·ªπ nƒÉng -->
                <div class="pf-section-title">K·ªπ nƒÉng</div>
                <div th:if="${profile.skills != null and !#lists.isEmpty(profile.skills)}">
                    <div class="pf-skills">
                        <span class="pf-skill-chip" th:each="sk : ${profile.skills}"
                              th:text="${sk}">
                            Java
                        </span>
                    </div>
                </div>
                <div class="pf-empty-text"
                     th:if="${profile.skills == null or #lists.isEmpty(profile.skills)}">
                    Ch∆∞a khai b√°o k·ªπ nƒÉng trong c√°c d·ª± √°n.
                </div>

                <!-- T·ªïng quan nhanh -->
                <div class="pf-section-title">T·ªïng quan</div>
                <div class="pf-metric-list">
                    <div class="pf-metric">
                        <div class="pf-metric-label">D·ª± √°n ƒëang tham gia</div>
                        <div class="pf-metric-value"
                             th:text="${profile.activeProjectsCount}">0</div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Task ƒëang m·ªü</div>
                        <div class="pf-metric-value"
                             th:text="${profile.openTasksCount}">0</div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">D·ª± √°n l√†m PM</div>
                        <div class="pf-metric-value"
                             th:text="${profile.pmProjectsCount}">0</div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Gi·ªù l√†m vi·ªác / tu·∫ßn</div>
                        <div class="pf-metric-value"
                             th:text="${profile.workHoursPerWeek}">40</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== RIGHT COLUMN ========== -->
        <section class="pf-right">

            <!-- Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y -->
            <div class="pf-card">
                <div class="pf-block-header">
                    <div class="pf-block-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</div>
                    <a class="pf-link" href="#">Xem t·∫•t c·∫£</a>
                </div>

                <div th:if="${profile.recentActivities != null and !#lists.isEmpty(profile.recentActivities)}"
                     class="pf-activity-list">
                    <div class="pf-activity-item"
                         th:each="act : ${profile.recentActivities}">
                        <div class="pf-activity-text">
                            <span th:text="${act.actor}">User</span>
                            <span th:if="${act.action == 'created'}"> ƒë√£ t·∫°o task </span>
                            <span th:if="${act.action == 'updated'}"> ƒë√£ c·∫≠p nh·∫≠t task </span>
                            "<span th:text="${act.title}">Task title</span>"
                        </div>
                        <div class="pf-activity-meta">
                            <span th:text="${act.status}">To Do</span>
                            ‚Ä¢
                            <span th:text="${#temporals.format(act.time,'dd/MM/yyyy HH:mm')}">
                                25/11/2025 14:30
                            </span>
                        </div>
                    </div>
                </div>

                <div class="pf-empty-text"
                     th:if="${profile.recentActivities == null or #lists.isEmpty(profile.recentActivities)}">
                    Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o g·∫ßn ƒë√¢y.
                </div>
            </div>

            <!-- D·ª± √°n ƒëang tham gia -->
            <div class="pf-card">
                <div class="pf-block-header">
                    <div class="pf-block-title">D·ª± √°n ƒëang tham gia</div>
                    <a class="pf-link" href="/projects">Xem danh s√°ch d·ª± √°n</a>
                </div>

                <div th:if="${profile.activeProjects != null and !#lists.isEmpty(profile.activeProjects)}"
                     class="pf-project-list">
                    <div class="pf-project-item" th:each="p : ${profile.activeProjects}">
                        <div class="pf-project-main">
                            <div class="pf-project-name"
                                 th:text="${p.projectName}">APT Project</div>
                            <div class="pf-project-meta">
                                <span class="pf-tag"
                                      th:text="${p.roleInProject}">Member</span>
                                <span class="pf-dot"></span>
                                <span th:text="${p.status}">In Progress</span>
                                <span class="pf-dot"
                                      th:if="${p.dateRange != null and !#strings.isEmpty(p.dateRange)}"></span>
                                <span th:text="${p.dateRange}"
                                      th:if="${p.dateRange != null and !#strings.isEmpty(p.dateRange)}">
                                    21/11/2025 - 30/11/2025
                                </span>
                            </div>
                        </div>
                        <div class="pf-project-stats">
                            <div>
                                <div class="pf-project-stat-label">Task m·ªü</div>
                                <div class="pf-project-stat-value"
                                     th:text="${p.openTasks}">3</div>
                            </div>
                            <div>
                                <div class="pf-project-stat-label">Task ho√†n th√†nh</div>
                                <div class="pf-project-stat-value"
                                     th:text="${p.doneTasks}">5</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pf-empty-text"
                     th:if="${profile.activeProjects == null or #lists.isEmpty(profile.activeProjects)}">
                    B·∫°n ch∆∞a tham gia d·ª± √°n n√†o ho·∫∑c t·∫•t c·∫£ d·ª± √°n ƒë√£ ho√†n th√†nh.
                </div>
            </div>

            <!-- Task c·ªßa b·∫°n (d√πng personalTaskStats, null-safe) -->
            <div class="pf-card">
                <div class="pf-block-header">
                    <div class="pf-block-title">Task c·ªßa b·∫°n</div>
                </div>

                <div class="pf-personal-stats">
                    <div class="pf-metric">
                        <div class="pf-metric-label">To Do</div>
                        <div class="pf-metric-value"
                             th:text="${profile.personalTaskStats != null ? profile.personalTaskStats.todo : 0}">
                            0
                        </div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">In Progress</div>
                        <div class="pf-metric-value"
                             th:text="${profile.personalTaskStats != null ? profile.personalTaskStats.inProgress : 0}">
                            0
                        </div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Review</div>
                        <div class="pf-metric-value"
                             th:text="${profile.personalTaskStats != null ? profile.personalTaskStats.review : 0}">
                            0
                        </div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Done</div>
                        <div class="pf-metric-value"
                             th:text="${profile.personalTaskStats != null ? profile.personalTaskStats.done : 0}">
                            0
                        </div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Goal ƒëang m·ªü</div>
                        <div class="pf-metric-value"
                             th:text="${profile.goalStats != null ? profile.goalStats.activeGoals : 0}">
                            0
                        </div>
                    </div>
                    <div class="pf-metric">
                        <div class="pf-metric-label">Goal ho√†n th√†nh</div>
                        <div class="pf-metric-value"
                             th:text="${profile.goalStats != null ? profile.goalStats.completedGoals : 0}">
                            0
                        </div>
                    </div>
                </div>
            </div>

            <!-- M·ª•c ti√™u & hi·ªáu su·∫•t -->
            <div class="pf-card">
                <div class="pf-block-header">
                    <div class="pf-block-title">M·ª•c ti√™u & hi·ªáu su·∫•t</div>
                </div>

                <div class="pf-goal-perf">
                    <!-- Goals -->
                    <div class="pf-goal-col">
                        <div class="pf-section-subtitle">Goals</div>
                        <div class="pf-metric">
                            <div class="pf-metric-label">Goal ƒëang m·ªü</div>
                            <div class="pf-metric-value"
                                 th:text="${profile.goalStats != null ? profile.goalStats.activeGoals : 0}">
                                0
                            </div>
                        </div>
                        <div class="pf-metric">
                            <div class="pf-metric-label">Goal ho√†n th√†nh</div>
                            <div class="pf-metric-value"
                                 th:text="${profile.goalStats != null ? profile.goalStats.completedGoals : 0}">
                                0
                            </div>
                        </div>
                        <div class="pf-meta-text"
                             th:if="${profile.goalStats != null and profile.goalStats.nextGoalTitle != null}">
                            Goal k·∫ø ti·∫øp:
                            <span th:text="${profile.goalStats.nextGoalTitle}">Thi·∫øt k·∫ø UI</span>
                            <span th:text="${' ‚Ä¢ h·∫°n ' + profile.goalStats.nextGoalDate}"
                                  th:if="${profile.goalStats.nextGoalDate != null}"> ‚Ä¢ h·∫°n 30/11</span>
                        </div>
                        <div class="pf-meta-text"
                             th:if="${profile.goalStats == null or profile.goalStats.nextGoalTitle == null}">
                            B·∫°n ch∆∞a c√≥ goal c√° nh√¢n n√†o ƒë∆∞·ª£c giao.
                        </div>
                    </div>

                    <!-- Performance / feedback -->
                    <div>
                        <div class="pf-section-subtitle">Feedback g·∫ßn ƒë√¢y</div>
                        <div class="pf-personal-next"
                             th:if="${profile.lastFeedback != null and !#strings.isEmpty(profile.lastFeedback)}">
                            <div class="pf-personal-label">Nh·∫≠n x√©t</div>
                            <div class="pf-meta-text" th:text="${profile.lastFeedback}">
                                B·∫°n x·ª≠ l√Ω task kh√° nhanh v√† ch·ªß ƒë·ªông review cho team.
                            </div>
                        </div>
                        <div class="pf-personal-next"
                             th:if="${profile.lastFeedback == null or #strings.isEmpty(profile.lastFeedback)}">
                            <div class="pf-personal-label">Ch∆∞a c√≥ feedback</div>
                            <div class="pf-meta-text">
                                Khi PM ho·∫∑c QA ƒë·ªÉ l·∫°i nh·∫≠n x√©t v·ªÅ hi·ªáu su·∫•t, ch√∫ng s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </main>
</div>

<script src="/assets/js/profile.js"></script>
<script>
    (function () {
        const avatar = document.getElementById('uhAvatar');
        const menu = document.getElementById('uhMenu');
        function toggle() { if (menu) menu.classList.toggle('is-open'); }
        function close(e) {
            if (menu && !menu.contains(e.target) && avatar && !avatar.contains(e.target)) {
                menu.classList.remove('is-open');
            }
        }
        if (avatar) {
            avatar.addEventListener('click', toggle);
            document.addEventListener('click', close);
        }
    })();
</script>
</body>
</html>
