<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <title>Dự án | Projects</title>
  <link href="/assets/css/styles.css" rel="stylesheet"/>
  <link href="/assets/css/user-home.css" rel="stylesheet"/>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body class="uh-dark">
<div class="uh-app">
  <!-- SIDEBAR -->
  <aside class="uh-sidebar">
    <div class="uh-sidebar-top">
      <div class="uh-logo">
        <span class="uh-logo-mark">APT</span>
        <span class="uh-logo-text">Project</span>
      </div>
    </div>

    <nav class="uh-nav">
      <a class="uh-nav-item is-active" href="#"><i class="fas fa-home"></i> For you</a>
      <a class="uh-nav-item" href="#"><i class="fas fa-clock"></i> Recent</a>
      <a class="uh-nav-item" href="#"><i class="fas fa-star"></i> Starred</a>

      <div class="uh-nav-section">Projects</div>

      <!-- Ai đăng nhập cũng tạo được (theo yêu cầu mới) -->
      <a class="uh-nav-item" th:href="@{/projects/create}" sec:authorize="isAuthenticated()">
        <i class="fas fa-plus"></i> Create project
      </a>
    </nav>

    <div class="uh-sidebar-bottom">
      <a class="uh-nav-item" href="#"><i class="fas fa-users"></i> Teams</a>
      <a class="uh-nav-item" href="#"><i class="fas fa-ellipsis-h"></i> More</a>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="uh-main">
    <!-- Header chung -->
    <th:block th:replace="~{commons/header :: header}"></th:block>

    <section class="uh-content">
      <!-- Page header -->
      <div class="uh-page-header">
        <h1>Projects</h1>
        <div class="uh-page-actions" sec:authorize="isAuthenticated()">
          <a class="uh-btn uh-btn-secondary" th:href="@{/projects/create}">Create project</a>
        </div>
      </div>

      <!-- Controls (search + filter) -->
      <div class="uh-controls">
        <form th:action="@{/projects}" method="get" class="uh-input-wrap" style="flex:1">
          <i class="fas fa-search uh-input-icon"></i>
          <input type="text" name="q" th:value="${q}" placeholder="Search projects"/>
        </form>

        <div class="uh-input-wrap">
          <button class="uh-select" type="button">
            Filter by type <span class="caret">▾</span>
          </button>
        </div>
      </div>

      <!-- TABLE PROJECTS -->
      <div class="uh-table">
        <!-- Header table -->
        <div class="uh-thead">
          <div class="uh-th star"></div>
          <div class="uh-th name">Name</div>
          <div class="uh-th type">Type</div>
          <div class="uh-th lead">PM</div>
          <div class="uh-th status">Status</div>
          <div class="uh-th dates">Dates</div>
          <div class="uh-th members">Members</div>
          <div class="uh-th more"></div>
        </div>

        <!-- Empty state -->
        <div class="uh-tbody" th:if="${#lists.isEmpty(projects)}">
          <div class="uh-row empty">
            No projects yet
          </div>
        </div>

        <!-- Data -->
        <div class="uh-tbody" th:if="${!#lists.isEmpty(projects)}">
          <div class="uh-row" th:each="p : ${projects}">
            <!-- Star -->
            <div class="uh-td star">
              <i class="far fa-star"></i>
            </div>

            <!-- Name -->
            <div class="uh-td name">
              <a th:href="@{|/projects/${p.projectId}|}"
                 th:text="${p.projectName}">Project name</a>
            </div>

            <!-- Type (join từ project_types) -->
            <div class="uh-td type"
                 th:text="${p.typeName != null ? p.typeName : '—'}">
              Type
            </div>

            <!-- PM / Leader -->
            <div class="uh-td lead"
                 th:text="${p.pmName != null ? p.pmName : (p.leaderName != null ? p.leaderName : '—')}">
              PM
            </div>

            <!-- Status -->
            <div class="uh-td status">
              <div class="uh-td status">
			  <span class="uh-badge"
			        th:classappend="${p.status == 'Planned' ? ' is-planned' :
			                        (p.status == 'In Progress' ? ' is-inprogress' :
			                        (p.status == 'Completed' ? ' is-completed' :
			                        (p.status == 'On Hold' ? ' is-onhold' : '')))}"
			        th:text="${p.status}">
			    Planned
			  </span>
			</div>

            </div>

            <!-- Dates -->
            <div class="uh-td dates">
              <span th:text="${p.startDate != null ? #temporals.format(p.startDate, 'dd/MM/yyyy') : '—'}"></span>
              &nbsp;–&nbsp;
              <span th:text="${p.endDate != null ? #temporals.format(p.endDate, 'dd/MM/yyyy') : '—'}"></span>
            </div>

            <!-- Members -->
            <div class="uh-td members">
              <i class="fas fa-user-friends"></i>
              <span th:text="${p.memberCount != null ? p.memberCount : 0}">0</span>
            </div>

            <!-- Actions -->
            <div class="uh-td more">
              <a th:href="@{|/projects/${p.projectId}|}" title="View">
                <i class="fas fa-external-link-alt"></i>
              </a>
              <a th:href="@{|/projects/${p.projectId}/edit|}"
                 sec:authorize="isAuthenticated()"
                 title="Edit">
                <i class="fas fa-pen"></i>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination (dữ liệu cứng, sau này có thể bind) -->
      <div class="uh-pagination">
        <button class="uh-btn uh-btn-tertiary" disabled>‹</button>
        <button class="uh-btn uh-btn-secondary is-active">1</button>
        <button class="uh-btn uh-btn-tertiary" disabled>›</button>
      </div>
    </section>
  </main>
</div>

<script>
  (function () {
    const avatar = document.getElementById('uhAvatar');
    const menu = document.getElementById('uhMenu');

    function toggle() {
      if (menu) {
        menu.classList.toggle('is-open');
      }
    }

    function close(e) {
      if (menu && avatar && !menu.contains(e.target) && !avatar.contains(e.target)) {
        menu.classList.remove('is-open');
      }
    }

    if (avatar) {
      avatar.addEventListener('click', toggle);
      document.addEventListener('click', close);
    }
  })();
</script>
</body>
</html>
